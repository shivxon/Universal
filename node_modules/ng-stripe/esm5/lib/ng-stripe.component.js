/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, Output, EventEmitter } from '@angular/core';
import { HttpClient, HttpHeaders, HttpParams } from '@angular/common/http';
import { FormBuilder, Validators } from '@angular/forms';
import { CreditCardValidator } from 'angular-cc-library';
var NgStripeComponent = /** @class */ (function () {
    function NgStripeComponent(httpClient, formBuilder) {
        this.httpClient = httpClient;
        this.formBuilder = formBuilder;
        this.stripeBtnText = 'Pay Now';
        this.stripeBtnLoading = 'Please Wait..';
        this.BtnText = 'Pay Now';
        this.stripe = {
            stripeBtnText: 'Pay Now',
            stripMessage: '',
            stripBtnDisabled: false,
            submitted: false,
            stripData: {}
        };
        this.apiResponse = new EventEmitter();
        this.stripeCardForm = this.formBuilder.group({
            name: ['', [(/** @type {?} */ (Validators.required))]],
            cardNumber: ['', [(/** @type {?} */ (CreditCardValidator.validateCCNumber))]],
            expirationDate: ['', [(/** @type {?} */ (CreditCardValidator.validateExpDate))]],
            cvc: ['', [(/** @type {?} */ (Validators.required)), (/** @type {?} */ (Validators.minLength(3))), (/** @type {?} */ (Validators.maxLength(4)))]]
        });
    }
    Object.defineProperty(NgStripeComponent.prototype, "setstripeBtnText", {
        set: /**
         * @param {?} stripeBtnText
         * @return {?}
         */
        function (stripeBtnText) {
            this.stripeBtnText = stripeBtnText;
            this.BtnText = this.stripeBtnText;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(NgStripeComponent.prototype, "setcurrency", {
        set: /**
         * @param {?} currency
         * @return {?}
         */
        function (currency) {
            this.currency = currency;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(NgStripeComponent.prototype, "setorderId", {
        set: /**
         * @param {?} orderId
         * @return {?}
         */
        function (orderId) {
            this.orderId = orderId;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(NgStripeComponent.prototype, "setemail", {
        set: /**
         * @param {?} email
         * @return {?}
         */
        function (email) {
            this.email = email;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(NgStripeComponent.prototype, "setstripeBtnLoading", {
        set: /**
         * @param {?} stripeBtnLoading
         * @return {?}
         */
        function (stripeBtnLoading) {
            this.stripeBtnLoading = stripeBtnLoading;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(NgStripeComponent.prototype, "setapiKey", {
        set: /**
         * @param {?} apiKey
         * @return {?}
         */
        function (apiKey) {
            this.apiKey = apiKey;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(NgStripeComponent.prototype, "setapiSecret", {
        set: /**
         * @param {?} apiSecret
         * @return {?}
         */
        function (apiSecret) {
            this.apiSecret = apiSecret;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(NgStripeComponent.prototype, "settotalAmount", {
        set: /**
         * @param {?} totalAmount
         * @return {?}
         */
        function (totalAmount) {
            this.totalAmount = totalAmount;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    NgStripeComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
    };
    Object.defineProperty(NgStripeComponent.prototype, "f", {
        /* Stripe Payment */
        get: /* Stripe Payment */
        /**
         * @return {?}
         */
        function () { return this.stripeCardForm.controls; },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    NgStripeComponent.prototype.payUsingStripe = /**
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var total = parseFloat((Math.round(this.totalAmount * 100) / 100).toFixed(2));
        console.log('Total Order Amounth is ' + total);
        /** @type {?} */
        var amount = Math.round(total * 100).toString();
        this.stripe.submitted = true;
        // stop here if form is invalid
        if (this.stripeCardForm.invalid) {
            return;
        }
        this.BtnText = this.stripeBtnLoading;
        this.stripe.stripBtnDisabled = true;
        /* Generating card token */
        /** @type {?} */
        var tokenbody = new HttpParams()
            .set('card[number]', this.stripeCardForm.value.cardNumber)
            .set('card[cvc]', this.stripeCardForm.value.cvc)
            .set('card[exp_month]', this.getMonth(this.stripeCardForm.value.expirationDate))
            .set('card[exp_year]', this.getYear(this.stripeCardForm.value.expirationDate))
            .set('card[name]', this.stripeCardForm.value.name)
            .set('key', this.apiKey);
        /** @type {?} */
        var httpOptions = {
            headers: new HttpHeaders({
                Authorization: 'Bearer ' + this.apiSecret,
                'Content-Type': 'application/x-www-form-urlencoded'
            })
        };
        this
            .httpClient
            .post("https://api.stripe.com/v1/tokens", tokenbody, httpOptions)
            .subscribe((/**
         * @param {?} data
         * @return {?}
         */
        function (data) {
            if (data) {
                /** @type {?} */
                var description = 'Order id ' + _this.orderId + ' and user ' + _this.email + '';
                /** @type {?} */
                var body = new HttpParams()
                    .set('amount', amount)
                    .set('currency', _this.currency)
                    .set('source', data.id)
                    .set('description', description);
                _this
                    .httpClient
                    .post("https://api.stripe.com/v1/charges", body, httpOptions)
                    .subscribe((/**
                 * @param {?} datas
                 * @return {?}
                 */
                function (datas) {
                    _this.apiResponse.emit({ data: datas, token: data });
                    _this.stripe.stripBtnDisabled = true;
                    _this.stripe.stripMessage = '';
                    _this.BtnText = _this.stripeBtnText;
                }), (/**
                 * @param {?} errs
                 * @return {?}
                 */
                function (errs) {
                    _this.apiResponse.emit({ breaks: 'charges', err: errs });
                    _this.stripe.stripBtnDisabled = false;
                    _this.BtnText = _this.stripeBtnText;
                }));
            }
        }), (/**
         * @param {?} err
         * @return {?}
         */
        function (err) {
            _this.apiResponse.emit({ breaks: 'tokens', err: err });
            _this.stripe.stripBtnDisabled = false;
            _this.BtnText = _this.stripeBtnText;
        }));
    };
    /**
     * @param {?} data
     * @return {?}
     */
    NgStripeComponent.prototype.getMonth = /**
     * @param {?} data
     * @return {?}
     */
    function (data) {
        return data.substring(0, 2);
    };
    /**
     * @param {?} data
     * @return {?}
     */
    NgStripeComponent.prototype.getYear = /**
     * @param {?} data
     * @return {?}
     */
    function (data) {
        /** @type {?} */
        var y = data.split('/');
        if (y.length > 1) {
            return y[1].trim();
        }
    };
    NgStripeComponent.decorators = [
        { type: Component, args: [{
                    selector: 'lib-ng-stripe',
                    template: "<form [formGroup]=\"stripeCardForm\" novalidate (ngSubmit)=\"payUsingStripe()\" class=\"text-center\">\n    <div class=\"cardHolderW\">\n        <div class=\"cardHolder text-left\">\n            <div class=\"cardHolder-front\">\n                <div class=\"cardHolder-front-inner\">\n                    <div class=\"form-group\">\n                        <input type=\"text\" formControlName=\"cardNumber\" class=\"form-control\" [ngClass]=\"{ 'is-invalid': stripe.submitted && f.cardNumber.errors }\" placeholder=\"Card Number\" ccFormat />\n                        <div *ngIf=\"f.cardNumber.errors\" class=\"invalid-feedback\">\n                            <div *ngIf=\"f.cardNumber.errors.ccNumber\">Invalid Card Number</div>\n                        </div>\n                    </div>\n\n                    <div class=\"form-group\">\n                        <input type=\"tel\" formControlName=\"expirationDate\" class=\"form-control\" [ngClass]=\"{ 'is-invalid': stripe.submitted && f.expirationDate.errors }\" placeholder=\"Expiration Date\" ccExp />\n                        <div *ngIf=\"f.expirationDate.errors\" class=\"invalid-feedback\">\n                            <div *ngIf=\"f.expirationDate.errors.expDate\">Expiration Date is invalid</div>\n                        </div>\n                    </div>\n                </div>\n\n                <div class=\"form-group mt-15 mb-0\">\n                    <input type=\"text\" formControlName=\"name\" class=\"form-control\" [ngClass]=\"{ 'is-invalid': stripe.submitted && f.name.errors }\" placeholder=\"Card Holder Name\" />\n                    <div *ngIf=\"f.name.errors\" class=\"invalid-feedback\">\n                        <div *ngIf=\"f.name.errors.required\">Name is required</div>\n                    </div>\n                </div>\n\n            </div>\n            <div class=\"cardHolder-back\">\n                <div class=\"cardHolder-back-inner\">\n                    <div class=\"form-group\">\n                        <input type=\"text\" formControlName=\"cvc\" class=\"form-control\" [ngClass]=\"{ 'is-invalid': stripe.submitted && f.cvc.errors }\" ccCvc mask=\"0*\" placeholder=\"CVC\" mask=\"0000\" />\n                        <div *ngIf=\"f.cvc.errors\" class=\"invalid-feedback\">\n                            <div *ngIf=\"f.cvc.errors.required\">CVC is required</div>\n                            <div *ngIf=\"f.cvc.errors.maxlength || f.cvc.errors.minlength\">Invalid CVC</div>\n                        </div>\n                    </div>\n                    <p>Code on the back of your card</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"alert alert-danger\" *ngIf=\"stripe.stripMessage != ''\">\n            {{stripe.stripMessage}}\n        </div>\n\n        <button type=\"submit\" [disabled]=\"stripe.stripBtnDisabled\" class=\"btn btn-primary pt-2 pb-2 pr-4 pl-4 text-uppercase w-100 mb-15\">{{BtnText}}</button>\n\n    </div>\n</form>",
                    styles: [""]
                }] }
    ];
    /** @nocollapse */
    NgStripeComponent.ctorParameters = function () { return [
        { type: HttpClient },
        { type: FormBuilder }
    ]; };
    NgStripeComponent.propDecorators = {
        apiResponse: [{ type: Output }],
        setstripeBtnText: [{ type: Input, args: ['stripeBtnText',] }],
        setcurrency: [{ type: Input, args: ['currency',] }],
        setorderId: [{ type: Input, args: ['orderId',] }],
        setemail: [{ type: Input, args: ['email',] }],
        setstripeBtnLoading: [{ type: Input, args: ['stripeBtnLoading',] }],
        setapiKey: [{ type: Input, args: ['apiKey',] }],
        setapiSecret: [{ type: Input, args: ['apiSecret',] }],
        settotalAmount: [{ type: Input, args: ['totalAmount',] }]
    };
    return NgStripeComponent;
}());
export { NgStripeComponent };
if (false) {
    /** @type {?} */
    NgStripeComponent.prototype.apiKey;
    /** @type {?} */
    NgStripeComponent.prototype.apiSecret;
    /** @type {?} */
    NgStripeComponent.prototype.totalAmount;
    /** @type {?} */
    NgStripeComponent.prototype.stripeBtnText;
    /** @type {?} */
    NgStripeComponent.prototype.stripeBtnLoading;
    /** @type {?} */
    NgStripeComponent.prototype.BtnText;
    /** @type {?} */
    NgStripeComponent.prototype.orderId;
    /** @type {?} */
    NgStripeComponent.prototype.email;
    /** @type {?} */
    NgStripeComponent.prototype.currency;
    /** @type {?} */
    NgStripeComponent.prototype.stripeCardForm;
    /** @type {?} */
    NgStripeComponent.prototype.stripe;
    /** @type {?} */
    NgStripeComponent.prototype.apiResponse;
    /**
     * @type {?}
     * @private
     */
    NgStripeComponent.prototype.httpClient;
    /**
     * @type {?}
     * @private
     */
    NgStripeComponent.prototype.formBuilder;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmctc3RyaXBlLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25nLXN0cmlwZS8iLCJzb3VyY2VzIjpbImxpYi9uZy1zdHJpcGUuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFVLEtBQUssRUFBRSxNQUFNLEVBQUUsWUFBWSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQy9FLE9BQU8sRUFBRSxVQUFVLEVBQUUsV0FBVyxFQUFFLFVBQVUsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQzNFLE9BQU8sRUFBYSxXQUFXLEVBQUUsVUFBVSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDcEUsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFFekQ7SUEwQkUsMkJBQW9CLFVBQXNCLEVBQVUsV0FBd0I7UUFBeEQsZUFBVSxHQUFWLFVBQVUsQ0FBWTtRQUFVLGdCQUFXLEdBQVgsV0FBVyxDQUFhO1FBaEJyRSxrQkFBYSxHQUFHLFNBQVMsQ0FBQztRQUMxQixxQkFBZ0IsR0FBRyxlQUFlLENBQUM7UUFDbkMsWUFBTyxHQUFHLFNBQVMsQ0FBQztRQU8zQixXQUFNLEdBQVE7WUFDWixhQUFhLEVBQUUsU0FBUztZQUN4QixZQUFZLEVBQUUsRUFBRTtZQUNoQixnQkFBZ0IsRUFBRSxLQUFLO1lBQ3ZCLFNBQVMsRUFBRSxLQUFLO1lBQ2hCLFNBQVMsRUFBRSxFQUFFO1NBQ2QsQ0FBQztRQVdGLGdCQUFXLEdBQXlCLElBQUksWUFBWSxFQUFVLENBQUM7UUFUN0QsSUFBSSxDQUFDLGNBQWMsR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLEtBQUssQ0FBQztZQUMzQyxJQUFJLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxtQkFBTSxVQUFVLENBQUMsUUFBUSxFQUFBLENBQUMsQ0FBQztZQUN2QyxVQUFVLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxtQkFBTSxtQkFBbUIsQ0FBQyxnQkFB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Q0FBQztJQUM5QixDQUFDOzs7OztJQUNELG1DQUFPOzs7O0lBQVAsVUFBUSxJQUFTOztZQUNULENBQUMsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQztRQUN6QixJQUFJLENBQUMsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO1lBQ2hCLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDO1NBQ3BCO0lBQ0gsQ0FBQzs7Z0JBOUpGLFNBQVMsU0FBQztvQkFDVCxRQUFRLEVBQUUsZUFBZTtvQkFDekIsNjZGQUF5Qzs7aUJBRTFDOzs7O2dCQVJRLFVBQVU7Z0JBQ0MsV0FBVzs7OzhCQXNDNUIsTUFBTTttQ0FHTixLQUFLLFNBQUMsZUFBZTs4QkFLdEIsS0FBSyxTQUFDLFVBQVU7NkJBSWYsS0FBSyxTQUFDLFNBQVM7MkJBSWYsS0FBSyxTQUFDLE9BQU87c0NBSWIsS0FBSyxTQUFDLGtCQUFrQjs0QkFLeEIsS0FBSyxTQUFDLFFBQVE7K0JBS2QsS0FBSyxTQUFDLFdBQVc7aUNBSWpCLEtBQUssU0FBQyxhQUFhOztJQTBGdEIsd0JBQUM7Q0FBQSxBQS9KRCxJQStKQztTQTFKWSxpQkFBaUI7OztJQUU1QixtQ0FBc0I7O0lBQ3RCLHNDQUF5Qjs7SUFDekIsd0NBQTJCOztJQUMzQiwwQ0FBaUM7O0lBQ2pDLDZDQUEwQzs7SUFDMUMsb0NBQTJCOztJQUMzQixvQ0FBb0I7O0lBQ3BCLGtDQUFrQjs7SUFDbEIscUNBQXdCOztJQUd4QiwyQ0FBaUM7O0lBQ2pDLG1DQU1FOztJQVVGLHdDQUMrRDs7Ozs7SUFWbkQsdUNBQThCOzs7OztJQUFFLHdDQUFnQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0LCBJbnB1dCwgT3V0cHV0LCBFdmVudEVtaXR0ZXIgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEh0dHBDbGllbnQsIEh0dHBIZWFkZXJzLCBIdHRwUGFyYW1zIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xuaW1wb3J0IHsgRm9ybUdyb3VwLCBGb3JtQnVpbGRlciwgVmFsaWRhdG9ycyB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJzsgXG5pbXBvcnQgeyBDcmVkaXRDYXJkVmFsaWRhdG9yIH0gZnJvbSAnYW5ndWxhci1jYy1saWJyYXJ5JztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnbGliLW5nLXN0cmlwZScsXG4gIHRlbXBsYXRlVXJsOiAnLi9uZy1zdHJpcGUuY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnLi9uZy1zdHJpcGUuY29tcG9uZW50LmNzcyddXG59KVxuZXhwb3J0IGNsYXNzIE5nU3RyaXBlQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcblxuICBwdWJsaWMgYXBpS2V5OiBzdHJpbmc7XG4gIHB1YmxpYyBhcGlTZWNyZXQ6IHN0cmluZztcbiAgcHVibGljIHRvdGFsQW1vdW50OiBudW1iZXI7XG4gIHB1YmxpYyBzdHJpcGVCdG5UZXh0ID0gJ1BheSBOb3cnO1xuICBwdWJsaWMgc3RyaXBlQnRuTG9hZGluZyA9ICdQbGVhc2UgV2FpdC4uJztcbiAgcHVibGljIEJ0blRleHQgPSAnUGF5IE5vdyc7XG4gIHB1YmxpYyBvcmRlcklkOiBhbnk7XG4gIHB1YmxpYyBlbWFpbDogYW55O1xuICBwdWJsaWMgY3VycmVuY3k6IHN0cmluZztcblxuICAvKiBTdHJpcGUgKi9cbiAgcHVibGljIHN0cmlwZUNhcmRGb3JtOiBGb3JtR3JvdXA7XG4gIHN0cmlwZTogYW55ID0ge1xuICAgIHN0cmlwZUJ0blRleHQ6ICdQYXkgTm93JyxcbiAgICBzdHJpcE1lc3NhZ2U6ICcnLFxuICAgIHN0cmlwQnRuRGlzYWJsZWQ6IGZhbHNlLFxuICAgIHN1Ym1pdHRlZDogZmFsc2UsXG4gICAgc3RyaXBEYXRhOiB7fVxuICB9O1xuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGh0dHBDbGllbnQ6IEh0dHBDbGllbnQsIHByaXZhdGUgZm9ybUJ1aWxkZXI6IEZvcm1CdWlsZGVyKSB7XG4gICAgdGhpcy5zdHJpcGVDYXJkRm9ybSA9IHRoaXMuZm9ybUJ1aWxkZXIuZ3JvdXAoe1xuICAgICAgbmFtZTogWycnLCBbPGFueT4gVmFsaWRhdG9ycy5yZXF1aXJlZF1dLFxuICAgICAgY2FyZE51bWJlcjogWycnLCBbPGFueT4gQ3JlZGl0Q2FyZFZhbGlkYXRvci52YWxpZGF0ZUNDTnVtYmVyXV0sXG4gICAgICBleHBpcmF0aW9uRGF0ZTogWycnLCBbPGFueT4gQ3JlZGl0Q2FyZFZhbGlkYXRvci52YWxpZGF0ZUV4cERhdGVdXSxcbiAgICAgIGN2YzogWycnLCBbPGFueT4gVmFsaWRhdG9ycy5yZXF1aXJlZCwgPGFueT4gVmFsaWRhdG9ycy5taW5MZW5ndGgoMyksIDxhbnk+IFZhbGlkYXRvcnMubWF4TGVuZ3RoKDQpXV1cbiAgICB9KTtcbiAgfVxuXHRcbiAgQE91dHB1dCgpXG4gIGFwaVJlc3BvbnNlOiBFdmVudEVtaXR0ZXI8T2JqZWN0PiA9IG5ldyBFdmVudEVtaXR0ZXI8T2JqZWN0PigpO1xuXG4gIEBJbnB1dCgnc3RyaXBlQnRuVGV4dCcpXG4gIHB1YmxpYyBzZXQgc2V0c3RyaXBlQnRuVGV4dChzdHJpcGVCdG5UZXh0OiBzdHJpbmcpIHtcbiAgICB0aGlzLnN0cmlwZUJ0blRleHQgPSBzdHJpcGVCdG5UZXh0O1xuICAgIHRoaXMuQnRuVGV4dCA9IHRoaXMuc3RyaXBlQnRuVGV4dDtcbiAgfVxuXHRASW5wdXQoJ2N1cnJlbmN5JylcbiAgcHVibGljIHNldCBzZXRjdXJyZW5jeShjdXJyZW5jeTogc3RyaW5nKSB7XG4gICAgdGhpcy5jdXJyZW5jeSA9IGN1cnJlbmN5OyBcbiAgfVxuICBASW5wdXQoJ29yZGVySWQnKVxuICBwdWJsaWMgc2V0IHNldG9yZGVySWQob3JkZXJJZDogc3RyaW5nKSB7XG4gICAgdGhpcy5vcmRlcklkID0gb3JkZXJJZDtcbiAgfVxuICBASW5wdXQoJ2VtYWlsJylcbiAgcHVibGljIHNldCBzZXRlbWFpbChlbWFpbDogc3RyaW5nKSB7XG4gICAgdGhpcy5lbWFpbCA9IGVtYWlsO1xuICB9XG4gIEBJbnB1dCgnc3RyaXBlQnRuTG9hZGluZycpXG4gIHB1YmxpYyBzZXQgc2V0c3RyaXBlQnRuTG9hZGluZyhzdHJpcGVCdG5Mb2FkaW5nOiBzdHJpbmcpIHtcbiAgICB0aGlzLnN0cmlwZUJ0bkxvYWRpbmcgPSBzdHJpcGVCdG5Mb2FkaW5nO1xuICB9XG5cbiAgQElucHV0KCdhcGlLZXknKVxuICBwdWJsaWMgc2V0IHNldGFwaUtleShhcGlLZXk6IHN0cmluZykge1xuICAgIHRoaXMuYXBpS2V5ID0gYXBpS2V5O1xuICB9XG5cbiAgQElucHV0KCdhcGlTZWNyZXQnKVxuICBwdWJsaWMgc2V0IHNldGFwaVNlY3JldChhcGlTZWNyZXQ6IHN0cmluZykge1xuICAgIHRoaXMuYXBpU2VjcmV0ID0gYXBpU2VjcmV0O1xuICB9XG4gIEBJbnB1dCgndG90YWxBbW91bnQnKVxuICBwdWJsaWMgc2V0IHNldHRvdGFsQW1vdW50KHRvdGFsQW1vdW50OiBudW1iZXIpIHtcbiAgICB0aGlzLnRvdGFsQW1vdW50ID0gdG90YWxBbW91bnQ7XG4gIH1cblxuICBuZ09uSW5pdCgpIHtcbiAgfVxuXG4gIC8qIFN0cmlwZSBQYXltZW50ICovXG4gIGdldCBmKCkgeyByZXR1cm4gdGhpcy5zdHJpcGVDYXJkRm9ybS5jb250cm9sczsgfVxuXG4gIHBheVVzaW5nU3RyaXBlKCkge1xuICAgIGNvbnN0IHRvdGFsID0gcGFyc2VGbG9hdCgoTWF0aC5yb3VuZCh0aGlzLnRvdGFsQW1vdW50ICogMTAwKSAvIDEwMCkudG9GaXhlZCgyKSk7XG4gICAgY29uc29sZS5sb2coJ1RvdGFsIE9yZGVyIEFtb3VudGggaXMgJyArIHRvdGFsKTtcbiAgICBjb25zdCBhbW91bnQgPSBNYXRoLnJvdW5kKHRvdGFsICogMTAwKS50b1N0cmluZygpO1xuICAgIHRoaXMuc3RyaXBlLnN1Ym1pdHRlZCA9IHRydWU7XG5cbiAgICAvLyBzdG9wIGhlcmUgaWYgZm9ybSBpcyBpbnZhbGlkXG4gICAgaWYgKHRoaXMuc3RyaXBlQ2FyZEZvcm0uaW52YWxpZCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuQnRuVGV4dCA9IHRoaXMuc3RyaXBlQnRuTG9hZGluZztcbiAgICB0aGlzLnN0cmlwZS5zdHJpcEJ0bkRpc2FibGVkID0gdHJ1ZTtcblxuICAgIC8qIEdlbmVyYXRpbmcgY2FyZCB0b2tlbiAqL1xuICAgIGNvbnN0IHRva2VuYm9keSA9IG5ldyBIdHRwUGFyYW1zKClcbiAgICAgIC5zZXQoJ2NhcmRbbnVtYmVyXScsIHRoaXMuc3RyaXBlQ2FyZEZvcm0udmFsdWUuY2FyZE51bWJlcilcbiAgICAgIC5zZXQoJ2NhcmRbY3ZjXScsIHRoaXMuc3RyaXBlQ2FyZEZvcm0udmFsdWUuY3ZjKVxuICAgICAgLnNldCgnY2FyZFtleHBfbW9udGhdJywgdGhpcy5nZXRNb250aCh0aGlzLnN0cmlwZUNhcmRGb3JtLnZhbHVlLmV4cGlyYXRpb25EYXRlKSlcbiAgICAgIC5zZXQoJ2NhcmRbZXhwX3llYXJdJywgdGhpcy5nZXRZZWFyKHRoaXMuc3RyaXBlQ2FyZEZvcm0udmFsdWUuZXhwaXJhdGlvbkRhdGUpKVxuICAgICAgLnNldCgnY2FyZFtuYW1lXScsIHRoaXMuc3RyaXBlQ2FyZEZvcm0udmFsdWUubmFtZSlcbiAgICAgIC5zZXQoJ2tleScsIHRoaXMuYXBpS2V5KTtcbiAgICBjb25zdCBodHRwT3B0aW9ucyA9IHtcbiAgICAgIGhlYWRlcnM6IG5ldyBIdHRwSGVhZGVycyh7XG4gICAgICAgIEF1dGhvcml6YXRpb246ICdCZWFyZXIgJyArIHRoaXMuYXBpU2VjcmV0LFxuICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCdcbiAgICAgIH0pXG4gICAgfTtcblxuICAgIHRoaXNcbiAgICAgIC5odHRwQ2xpZW50XG4gICAgICAucG9zdChgaHR0cHM6Ly9hcGkuc3RyaXBlLmNvbS92MS90b2tlbnNgLCB0b2tlbmJvZHksIGh0dHBPcHRpb25zKVxuICAgICAgLnN1YnNjcmliZShcbiAgICAgICAgKGRhdGE6IGFueSkgPT4ge1xuICAgICAgICAgIGlmIChkYXRhKSB7XG5cbiAgICAgICAgICAgIGNvbnN0IGRlc2NyaXB0aW9uID0gJ09yZGVyIGlkICcgKyB0aGlzLm9yZGVySWQgKyAnIGFuZCB1c2VyICcgKyB0aGlzLmVtYWlsICsgJyc7XG5cbiAgICAgICAgICAgIGNvbnN0IGJvZHkgPSBuZXcgSHR0cFBhcmFtcygpXG4gICAgICAgICAgICAgIC5zZXQoJ2Ftb3VudCcsIGFtb3VudClcbiAgICAgICAgICAgICAgLnNldCgnY3VycmVuY3knLCB0aGlzLmN1cnJlbmN5KVxuICAgICAgICAgICAgICAuc2V0KCdzb3VyY2UnLCBkYXRhLmlkKVxuICAgICAgICAgICAgICAuc2V0KCdkZXNjcmlwdGlvbicsIGRlc2NyaXB0aW9uKTsgXG5cbiAgICAgICAgICAgIHRoaXNcbiAgICAgICAgICAgICAgLmh0dHBDbGllbnRcbiAgICAgICAgICAgICAgLnBvc3QoYGh0dHBzOi8vYXBpLnN0cmlwZS5jb20vdjEvY2hhcmdlc2AsIGJvZHksIGh0dHBPcHRpb25zKVxuICAgICAgICAgICAgICAuc3Vic2NyaWJlKFxuICAgICAgICAgICAgICAgIChkYXRhczogYW55KSA9PiB7XG4gICAgICAgICAgICAgICAgICB0aGlzLmFwaVJlc3BvbnNlLmVtaXQoe2RhdGE6IGRhdGFzLCB0b2tlbjogZGF0YX0pO1xuICAgICAgICAgICAgICAgICAgdGhpcy5zdHJpcGUuc3RyaXBCdG5EaXNhYmxlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICB0aGlzLnN0cmlwZS5zdHJpcE1lc3NhZ2UgPSAnJztcbiAgICAgICAgICAgICAgICAgIHRoaXMuQnRuVGV4dCA9IHRoaXMuc3RyaXBlQnRuVGV4dDtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIChlcnJzOiBhbnkpID0+IHtcbiAgICAgICAgICAgICAgICAgIHRoaXMuYXBpUmVzcG9uc2UuZW1pdCh7YnJlYWtzOiAnY2hhcmdlcycsIGVycjogZXJyc30pO1xuICAgICAgICAgICAgICAgICAgdGhpcy5zdHJpcGUuc3RyaXBCdG5EaXNhYmxlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgdGhpcy5CdG5UZXh0ID0gdGhpcy5zdHJpcGVCdG5UZXh0O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIChlcnI6IGFueSkgPT4ge1xuICAgICAgICAgIHRoaXMuYXBpUmVzcG9uc2UuZW1pdCh7YnJlYWtzOiAndG9rZW5zJywgZXJyOiBlcnJ9KTtcbiAgICAgICAgICB0aGlzLnN0cmlwZS5zdHJpcEJ0bkRpc2FibGVkID0gZmFsc2U7XG4gICAgICAgICAgdGhpcy5CdG5UZXh0ID0gdGhpcy5zdHJpcGVCdG5UZXh0O1xuICAgICAgICB9XG4gICAgICApO1xuICB9XG5cbiAgZ2V0TW9udGgoZGF0YTogYW55KSB7XG4gICAgcmV0dXJuIGRhdGEuc3Vic3RyaW5nKDAsIDIpO1xuICB9XG4gIGdldFllYXIoZGF0YTogYW55KSB7XG4gICAgY29uc3QgeSA9IGRhdGEuc3BsaXQoJy8nKTtcbiAgICBpZiAoeS5sZW5ndGggPiAxKSB7XG4gICAgICByZXR1cm4geVsxXS50cmltKCk7XG4gICAgfVxuICB9IFxufVxuIl19