/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, Output, EventEmitter } from '@angular/core';
import { HttpClient, HttpHeaders, HttpParams } from '@angular/common/http';
import { FormBuilder, Validators } from '@angular/forms';
import { CreditCardValidator } from 'angular-cc-library';
export class NgStripeComponent {
    /**
     * @param {?} httpClient
     * @param {?} formBuilder
     */
    constructor(httpClient, formBuilder) {
        this.httpClient = httpClient;
        this.formBuilder = formBuilder;
        this.stripeBtnText = 'Pay Now';
        this.stripeBtnLoading = 'Please Wait..';
        this.BtnText = 'Pay Now';
        this.stripe = {
            stripeBtnText: 'Pay Now',
            stripMessage: '',
            stripBtnDisabled: false,
            submitted: false,
            stripData: {}
        };
        this.apiResponse = new EventEmitter();
        this.stripeCardForm = this.formBuilder.group({
            name: ['', [(/** @type {?} */ (Validators.required))]],
            cardNumber: ['', [(/** @type {?} */ (CreditCardValidator.validateCCNumber))]],
            expirationDate: ['', [(/** @type {?} */ (CreditCardValidator.validateExpDate))]],
            cvc: ['', [(/** @type {?} */ (Validators.required)), (/** @type {?} */ (Validators.minLength(3))), (/** @type {?} */ (Validators.maxLength(4)))]]
        });
    }
    /**
     * @param {?} stripeBtnText
     * @return {?}
     */
    set setstripeBtnText(stripeBtnText) {
        this.stripeBtnText = stripeBtnText;
        this.BtnText = this.stripeBtnText;
    }
    /**
     * @param {?} currency
     * @return {?}
     */
    set setcurrency(currency) {
        this.currency = currency;
    }
    /**
     * @param {?} orderId
     * @return {?}
     */
    set setorderId(orderId) {
        this.orderId = orderId;
    }
    /**
     * @param {?} email
     * @return {?}
     */
    set setemail(email) {
        this.email = email;
    }
    /**
     * @param {?} stripeBtnLoading
     * @return {?}
     */
    set setstripeBtnLoading(stripeBtnLoading) {
        this.stripeBtnLoading = stripeBtnLoading;
    }
    /**
     * @param {?} apiKey
     * @return {?}
     */
    set setapiKey(apiKey) {
        this.apiKey = apiKey;
    }
    /**
     * @param {?} apiSecret
     * @return {?}
     */
    set setapiSecret(apiSecret) {
        this.apiSecret = apiSecret;
    }
    /**
     * @param {?} totalAmount
     * @return {?}
     */
    set settotalAmount(totalAmount) {
        this.totalAmount = totalAmount;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
    }
    /* Stripe Payment */
    /**
     * @return {?}
     */
    get f() { return this.stripeCardForm.controls; }
    /**
     * @return {?}
     */
    payUsingStripe() {
        /** @type {?} */
        const total = parseFloat((Math.round(this.totalAmount * 100) / 100).toFixed(2));
        console.log('Total Order Amounth is ' + total);
        /** @type {?} */
        const amount = Math.round(total * 100).toString();
        this.stripe.submitted = true;
        // stop here if form is invalid
        if (this.stripeCardForm.invalid) {
            return;
        }
        this.BtnText = this.stripeBtnLoading;
        this.stripe.stripBtnDisabled = true;
        /* Generating card token */
        /** @type {?} */
        const tokenbody = new HttpParams()
            .set('card[number]', this.stripeCardForm.value.cardNumber)
            .set('card[cvc]', this.stripeCardForm.value.cvc)
            .set('card[exp_month]', this.getMonth(this.stripeCardForm.value.expirationDate))
            .set('card[exp_year]', this.getYear(this.stripeCardForm.value.expirationDate))
            .set('card[name]', this.stripeCardForm.value.name)
            .set('key', this.apiKey);
        /** @type {?} */
        const httpOptions = {
            headers: new HttpHeaders({
                Authorization: 'Bearer ' + this.apiSecret,
                'Content-Type': 'application/x-www-form-urlencoded'
            })
        };
        this
            .httpClient
            .post(`https://api.stripe.com/v1/tokens`, tokenbody, httpOptions)
            .subscribe((/**
         * @param {?} data
         * @return {?}
         */
        (data) => {
            if (data) {
                /** @type {?} */
                const description = 'Order id ' + this.orderId + ' and user ' + this.email + '';
                /** @type {?} */
                const body = new HttpParams()
                    .set('amount', amount)
                    .set('currency', this.currency)
                    .set('source', data.id)
                    .set('description', description);
                this
                    .httpClient
                    .post(`https://api.stripe.com/v1/charges`, body, httpOptions)
                    .subscribe((/**
                 * @param {?} datas
                 * @return {?}
                 */
                (datas) => {
                    this.apiResponse.emit({ data: datas, token: data });
                    this.stripe.stripBtnDisabled = true;
                    this.stripe.stripMessage = '';
                    this.BtnText = this.stripeBtnText;
                }), (/**
                 * @param {?} errs
                 * @return {?}
                 */
                (errs) => {
                    this.apiResponse.emit({ breaks: 'charges', err: errs });
                    this.stripe.stripBtnDisabled = false;
                    this.BtnText = this.stripeBtnText;
                }));
            }
        }), (/**
         * @param {?} err
         * @return {?}
         */
        (err) => {
            this.apiResponse.emit({ breaks: 'tokens', err: err });
            this.stripe.stripBtnDisabled = false;
            this.BtnText = this.stripeBtnText;
        }));
    }
    /**
     * @param {?} data
     * @return {?}
     */
    getMonth(data) {
        return data.substring(0, 2);
    }
    /**
     * @param {?} data
     * @return {?}
     */
    getYear(data) {
        /** @type {?} */
        const y = data.split('/');
        if (y.length > 1) {
            return y[1].trim();
        }
    }
}
NgStripeComponent.decorators = [
    { type: Component, args: [{
                selector: 'lib-ng-stripe',
                template: "<form [formGroup]=\"stripeCardForm\" novalidate (ngSubmit)=\"payUsingStripe()\" class=\"text-center\">\n    <div class=\"cardHolderW\">\n        <div class=\"cardHolder text-left\">\n            <div class=\"cardHolder-front\">\n                <div class=\"cardHolder-front-inner\">\n                    <div class=\"form-group\">\n                        <input type=\"text\" formControlName=\"cardNumber\" class=\"form-control\" [ngClass]=\"{ 'is-invalid': stripe.submitted && f.cardNumber.errors }\" placeholder=\"Card Number\" ccFormat />\n                        <div *ngIf=\"f.cardNumber.errors\" class=\"invalid-feedback\">\n                            <div *ngIf=\"f.cardNumber.errors.ccNumber\">Invalid Card Number</div>\n                        </div>\n                    </div>\n\n                    <div class=\"form-group\">\n                        <input type=\"tel\" formControlName=\"expirationDate\" class=\"form-control\" [ngClass]=\"{ 'is-invalid': stripe.submitted && f.expirationDate.errors }\" placeholder=\"Expiration Date\" ccExp />\n                        <div *ngIf=\"f.expirationDate.errors\" class=\"invalid-feedback\">\n                            <div *ngIf=\"f.expirationDate.errors.expDate\">Expiration Date is invalid</div>\n                        </div>\n                    </div>\n                </div>\n\n                <div class=\"form-group mt-15 mb-0\">\n                    <input type=\"text\" formControlName=\"name\" class=\"form-control\" [ngClass]=\"{ 'is-invalid': stripe.submitted && f.name.errors }\" placeholder=\"Card Holder Name\" />\n                    <div *ngIf=\"f.name.errors\" class=\"invalid-feedback\">\n                        <div *ngIf=\"f.name.errors.required\">Name is required</div>\n                    </div>\n                </div>\n\n            </div>\n            <div class=\"cardHolder-back\">\n                <div class=\"cardHolder-back-inner\">\n                    <div class=\"form-group\">\n                        <input type=\"text\" formControlName=\"cvc\" class=\"form-control\" [ngClass]=\"{ 'is-invalid': stripe.submitted && f.cvc.errors }\" ccCvc mask=\"0*\" placeholder=\"CVC\" mask=\"0000\" />\n                        <div *ngIf=\"f.cvc.errors\" class=\"invalid-feedback\">\n                            <div *ngIf=\"f.cvc.errors.required\">CVC is required</div>\n                            <div *ngIf=\"f.cvc.errors.maxlength || f.cvc.errors.minlength\">Invalid CVC</div>\n                        </div>\n                    </div>\n                    <p>Code on the back of your card</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"alert alert-danger\" *ngIf=\"stripe.stripMessage != ''\">\n            {{stripe.stripMessage}}\n        </div>\n\n        <button type=\"submit\" [disabled]=\"stripe.stripBtnDisabled\" class=\"btn btn-primary pt-2 pb-2 pr-4 pl-4 text-uppercase w-100 mb-15\">{{BtnText}}</button>\n\n    </div>\n</form>",
                styles: [""]
            }] }
];
/** @nocollapse */
NgStripeComponent.ctorParameters = () => [
    { type: HttpClient },
    { type: FormBuilder }
];
NgStripeComponent.propDecorators = {
    apiResponse: [{ type: Output }],
    setstripeBtnText: [{ type: Input, args: ['stripeBtnText',] }],
    setcurrency: [{ type: Input, args: ['currency',] }],
    setorderId: [{ type: Input, args: ['orderId',] }],
    setemail: [{ type: Input, args: ['email',] }],
    setstripeBtnLoading: [{ type: Input, args: ['stripeBtnLoading',] }],
    setapiKey: [{ type: Input, args: ['apiKey',] }],
    setapiSecret: [{ type: Input, args: ['apiSecret',] }],
    settotalAmount: [{ type: Input, args: ['totalAmount',] }]
};
if (false) {
    /** @type {?} */
    NgStripeComponent.prototype.apiKey;
    /** @type {?} */
    NgStripeComponent.prototype.apiSecret;
    /** @type {?} */
    NgStripeComponent.prototype.totalAmount;
    /** @type {?} */
    NgStripeComponent.prototype.stripeBtnText;
    /** @type {?} */
    NgStripeComponent.prototype.stripeBtnLoading;
    /** @type {?} */
    NgStripeComponent.prototype.BtnText;
    /** @type {?} */
    NgStripeComponent.prototype.orderId;
    /** @type {?} */
    NgStripeComponent.prototype.email;
    /** @type {?} */
    NgStripeComponent.prototype.currency;
    /** @type {?} */
    NgStripeComponent.prototype.stripeCardForm;
    /** @type {?} */
    NgStripeComponent.prototype.stripe;
    /** @type {?} */
    NgStripeComponent.prototype.apiResponse;
    /**
     * @type {?}
     * @private
     */
    NgStripeComponent.prototype.httpClient;
    /**
     * @type {?}
     * @private
     */
    NgStripeComponent.prototype.formBuilder;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmctc3RyaXBlLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25nLXN0cmlwZS8iLCJzb3VyY2VzIjpbImxpYi9uZy1zdHJpcGUuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFVLEtBQUssRUFBRSxNQUFNLEVBQUUsWUFBWSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQy9FLE9BQU8sRUFBRSxVQUFVLEVBQUUsV0FBVyxFQUFFLFVBQVUsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQzNFLE9BQU8sRUFBYSxXQUFXLEVBQUUsVUFBVSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDcEUsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFPekQsTUFBTSxPQUFPLGlCQUFpQjs7Ozs7SUFxQjVCLFlBQW9CLFVBQXNCLEVBQVUsV0FBd0I7UUFBeEQsZUFBVSxHQUFWLFVBQVUsQ0FBWTtRQUFVLGdCQUFXLEdBQVgsV0FBVyxDQUFhO1FBaEJyRSxrQkFBYSxHQUFHLFNBQVMsQ0FBQztRQUMxQixxQkFBZ0IsR0FBRyxlQUFlLENBQUM7UUFDbkMsWUFBTyxHQUFHLFNBQVMsQ0FBQztRQU8zQixXQUFNLEdBQVE7WUFDWixhQUFhLEVBQUUsU0FBUztZQUN4QixZQUFZLEVBQUUsRUFBRTtZQUNoQixnQkFBZ0IsRUFBRSxLQUFLO1lBQ3ZCLFNBQVMsRUFBRSxLQUFLO1lBQ2hCLFNBQVMsRUFBRSxFQUFFO1NBQ2QsQ0FBQztRQVdGLGdCQUFXLEdBQXlCLElBQUksWUFBWSxFQUFVLENBQUM7UUFUN0QsSUFBSSxDQUFDLGNBQWMsR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLEtBQUssQ0FBQztZQUMzQyxJQUFJLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxtQkFBTSxVQUFVLENBQUMsUUFBUSxFQUFBLENBQUMsQ0FBQztZQUN2QyxVQUFVLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxtQkFBTSxtQkFBbUIsQ0FBQyxnQkFBZ0IsRUFBQSxDQUFDLENBQUM7WUFDOUQsY0FBYyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUMsbUJBQU0sbUJBQW1CLENBQUMsZUFBZSxFQUFBLENBQUMsQ0FBQztZQUNqRSxHQUFHLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxtQkFBTSxVQUFVLENBQUMsUUFBUSxFQUFBLEVBQUUsbUJBQU0sVUFBVSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsRUFBQSxFQUFFLG1CQUFNLFVBQVUsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLEVBQUEsQ0FBQyxDQUFDO1NBQ3JHLENBQUMsQ0FBQztJQUNMLENBQUM7Ozs7O0lBS0QsSUFDVyxnQkFBZ0IsQ0FBQyxhQUFxQjtRQUMvQyxJQUFJLENBQUMsYUFBYSxHQUFHLGFBQWEsQ0FBQztRQUNuQyxJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyxhQUFhLENBQUM7SUFDcEMsQ0FBQzs7Ozs7SUFDRixJQUNZLFdBQVcsQ0FBQyxRQUFnQjtRQUNyQyxJQUFJLENBQUMsUUFBUSxHQUFHLFFBQVEsQ0FBQztJQUMzQixDQUFDOzs7OztJQUNELElBQ1csVUFBVSxDQUFDLE9BQWU7UUFDbkMsSUFBSSxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUM7SUFDekIsQ0FBQzs7Ozs7SUFDRCxJQUNXLFFBQVEsQ0FBQyxLQUFhO1FBQy9CLElBQUksQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDO0lBQ3JCLENBQUM7Ozs7O0lBQ0QsSUFDVyxtQkFBbUIsQ0FBQyxnQkFBd0I7UUFDckQsSUFBSSxDQUFDLGdCQUFnQixHQUFHLGdCQUFnQixDQUFDO0lBQzNDLENBQUM7Ozs7O0lBRUQsSUFDVyxTQUFTLENBQUMsTUFBYztRQUNqQyxJQUFJLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQztJQUN2QixDQUFDOzs7OztJQUVELElBQ1csWUFBWSxDQUFDLFNBQWlCO1FBQ3ZDLElBQUksQ0FBQyxTQUFTLEdBQUcsU0FBUyxDQUFDO0lBQzdCLENBQUM7Ozs7O0lBQ0QsSUFDVyxjQUFjLENBQUMsV0FBbUI7UUFDM0MsSUFBSSxDQUFDLFdBQVcsR0FBRyxXQUFXLENBQUM7SUFDakMsQ0FBQzs7OztJQUVELFFBQVE7SUFDUixDQUFDOzs7OztJQUdELElBQUksQ0FBQyxLQUFLLE9BQU8sSUFBSSxDQUFDLGNBQWMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDOzs7O0lBRWhELGNBQWM7O2NBQ04sS0FBSyxHQUFHLFVBQVUsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLFdBQVcsR0FBRyxHQUFHLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDL0UsT0FBTyxDQUFDLEdBQUcsQ0FBQyx5QkFBeUIsR0FBRyxLQUFLLENBQUMsQ0FBQzs7Y0FDekMsTUFBTSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxHQUFHLEdBQUcsQ0FBQyxDQUFDLFFBQVEsRUFBRTtRQUNqRCxJQUFJLENBQUMsTUFBTSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUM7UUFFN0IsK0JBQStCO1FBQy9CLElBQUksSUFBSSxDQUFDLGNBQWMsQ0FBQyxPQUFPLEVBQUU7WUFDL0IsT0FBTztTQUNSO1FBRUQsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsZ0JBQWdCLENBQUM7UUFDckMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxnQkFBZ0IsR0FBRyxJQUFJLENBQUM7OztjQUc5QixTQUFTLEdBQUcsSUFBSSxVQUFVLEVBQUU7YUFDL0IsR0FBRyxDQUFDLGNBQWMsRUFBRSxJQUFJLENBQUMsY0FBYyxDQUFDLEtBQUssQ0FBQyxVQUFVLENBQUM7YUFDekQsR0FBRyxDQUFDLFdBQVcsRUFBRSxJQUFJLENBQUMsY0FBYyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUM7YUFDL0MsR0FBRyxDQUFDLGlCQUFpQixFQUFFLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxLQUFLLENBQUMsY0FBYyxDQUFDLENBQUM7YUFDL0UsR0FBRyxDQUFDLGdCQUFnQixFQUFFLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxLQUFLLENBQUMsY0FBYyxDQUFDLENBQUM7YUFDN0UsR0FBRyxDQUFDLFlBQVksRUFBRSxJQUFJLENBQUMsY0FBYyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUM7YUFDakQsR0FBRyxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDOztjQUNwQixXQUFXLEdBQUc7WUFDbEIsT0FBTyxFQUFFLElBQUksV0FBVyxDQUFDO2dCQUN2QixhQUFhLEVBQUUsU0FBUyxHQUFHLElBQUksQ0FBQyxTQUFTO2dCQUN6QyxjQUFjLEVBQUUsbUNBQW1DO2FBQ3BELENBQUM7U0FDSDtRQUVELElBQUk7YUFDRCxVQUFVO2FBQ1YsSUFBSSxDQUFDLGtDQUFrQyxFQUFFLFNBQVMsRUFBRSxXQUFXLENBQUM7YUFDaEUsU0FBUzs7OztRQUNSLENBQUMsSUFBUyxFQUFFLEVBQUU7WUFDWixJQUFJLElBQUksRUFBRTs7c0JBRUYsV0FBVyxHQUFHLFdBQVcsR0FBRyxJQUFJLENBQUMsT0FBTyxHQUFHLFlBQVksR0FBRyxJQUFJLENBQUMsS0FBSyxHQUFHLEVBQUU7O3NCQUV6RSxJQUFJLEdBQUcsSUFBSSxVQUFVLEVBQUU7cUJBQzFCLEdBQUcsQ0FBQyxRQUFRLEVBQUUsTUFBTSxDQUFDO3FCQUNyQixHQUFHLENBQUMsVUFBVSxFQUFFLElBQUksQ0FBQyxRQUFRLENBQUM7cUJBQzlCLEdBQUcsQ0FBQyxRQUFRLEVBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQztxQkFDdEIsR0FBRyxDQUFDLGFBQWEsRUFBRSxXQUFXLENBQUM7Z0JBRWxDLElBQUk7cUJBQ0QsVUFBVTtxQkFDVixJQUFJLENBQUMsbUNBQW1DLEVBQUUsSUFBSSxFQUFFLFdBQVcsQ0FBQztxQkFDNUQsU0FBUzs7OztnQkFDUixDQUFDLEtBQVUsRUFBRSxFQUFFO29CQUNiLElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLEVBQUMsSUFBSSxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFDLENBQUMsQ0FBQztvQkFDbEQsSUFBSSxDQUFDLE1BQU0sQ0FBQyxnQkFBZ0IsR0FBRyxJQUFJLENBQUM7b0JBQ3BDLElBQUksQ0FBQyxNQUFNLENBQUMsWUFBWSxHQUFHLEVBQUUsQ0FBQztvQkFDOUIsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDO2dCQUNwQyxDQUFDOzs7O2dCQUNELENBQUMsSUFBUyxFQUFFLEVBQUU7b0JBQ1osSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsRUFBQyxNQUFNLEVBQUUsU0FBUyxFQUFFLEdBQUcsRUFBRSxJQUFJLEVBQUMsQ0FBQyxDQUFDO29CQUN0RCxJQUFJLENBQUMsTUFBTSxDQUFDLGdCQUFnQixHQUFHLEtBQUssQ0FBQztvQkFDckMsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDO2dCQUNwQyxDQUFDLEVBQ0YsQ0FBQzthQUNMO1FBQ0gsQ0FBQzs7OztRQUNELENBQUMsR0FBUSxFQUFFLEVBQUU7WUFDWCxJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxFQUFDLE1BQU0sRUFBRSxRQUFRLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBQyxDQUFDLENBQUM7WUFDcEQsSUFBSSxDQUFDLE1BQU0sQ0FBQyxnQkFBZ0IsR0FBRyxLQUFLLENBQUM7WUFDckMsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDO1FBQ3BDLENBQUMsRUFDRixDQUFDO0lBQ04sQ0FBQzs7Ozs7SUFFRCxRQUFRLENBQUMsSUFBUztRQUNoQixPQUFPLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO0lBQzlCLENBQUM7Ozs7O0lBQ0QsT0FBTyxDQUFDLElBQVM7O2NBQ1QsQ0FBQyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDO1FBQ3pCLElBQUksQ0FBQyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7WUFDaEIsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUM7U0FDcEI7SUFDSCxDQUFDOzs7WUE5SkYsU0FBUyxTQUFDO2dCQUNULFFBQVEsRUFBRSxlQUFlO2dCQUN6Qiw2NkZBQXlDOzthQUUxQzs7OztZQVJRLFVBQVU7WUFDQyxXQUFXOzs7MEJBc0M1QixNQUFNOytCQUdOLEtBQUssU0FBQyxlQUFlOzBCQUt0QixLQUFLLFNBQUMsVUFBVTt5QkFJZixLQUFLLFNBQUMsU0FBUzt1QkFJZixLQUFLLFNBQUMsT0FBTztrQ0FJYixLQUFLLFNBQUMsa0JBQWtCO3dCQUt4QixLQUFLLFNBQUMsUUFBUTsyQkFLZCxLQUFLLFNBQUMsV0FBVzs2QkFJakIsS0FBSyxTQUFDLGFBQWE7Ozs7SUE5RHBCLG1DQUFzQjs7SUFDdEIsc0NBQXlCOztJQUN6Qix3Q0FBMkI7O0lBQzNCLDBDQUFpQzs7SUFDakMsNkNBQTBDOztJQUMxQyxvQ0FBMkI7O0lBQzNCLG9DQUFvQjs7SUFDcEIsa0NBQWtCOztJQUNsQixxQ0FBd0I7O0lBR3hCLDJDQUFpQzs7SUFDakMsbUNBTUU7O0lBVUYsd0NBQytEOzs7OztJQVZuRCx1Q0FBOEI7Ozs7O0lBQUUsd0NBQWdDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIElucHV0LCBPdXRwdXQsIEV2ZW50RW1pdHRlciB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgSHR0cENsaWVudCwgSHR0cEhlYWRlcnMsIEh0dHBQYXJhbXMgfSBmcm9tICdAYW5ndWxhci9jb21tb24vaHR0cCc7XG5pbXBvcnQgeyBGb3JtR3JvdXAsIEZvcm1CdWlsZGVyLCBWYWxpZGF0b3JzIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnOyBcbmltcG9ydCB7IENyZWRpdENhcmRWYWxpZGF0b3IgfSBmcm9tICdhbmd1bGFyLWNjLWxpYnJhcnknO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdsaWItbmctc3RyaXBlJyxcbiAgdGVtcGxhdGVVcmw6ICcuL25nLXN0cmlwZS5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL25nLXN0cmlwZS5jb21wb25lbnQuY3NzJ11cbn0pXG5leHBvcnQgY2xhc3MgTmdTdHJpcGVDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xuXG4gIHB1YmxpYyBhcGlLZXk6IHN0cmluZztcbiAgcHVibGljIGFwaVNlY3JldDogc3RyaW5nO1xuICBwdWJsaWMgdG90YWxBbW91bnQ6IG51bWJlcjtcbiAgcHVibGljIHN0cmlwZUJ0blRleHQgPSAnUGF5IE5vdyc7XG4gIHB1YmxpYyBzdHJpcGVCdG5Mb2FkaW5nID0gJ1BsZWFzZSBXYWl0Li4nO1xuICBwdWJsaWMgQnRuVGV4dCA9ICdQYXkgTm93JztcbiAgcHVibGljIG9yZGVySWQ6IGFueTtcbiAgcHVibGljIGVtYWlsOiBhbnk7XG4gIHB1YmxpYyBjdXJyZW5jeTogc3RyaW5nO1xuXG4gIC8qIFN0cmlwZSAqL1xuICBwdWJsaWMgc3RyaXBlQ2FyZEZvcm06IEZvcm1Hcm91cDtcbiAgc3RyaXBlOiBhbnkgPSB7XG4gICAgc3RyaXBlQnRuVGV4dDogJ1BheSBOb3cnLFxuICAgIHN0cmlwTWVzc2FnZTogJycsXG4gICAgc3RyaXBCdG5EaXNhYmxlZDogZmFsc2UsXG4gICAgc3VibWl0dGVkOiBmYWxzZSxcbiAgICBzdHJpcERhdGE6IHt9XG4gIH07XG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgaHR0cENsaWVudDogSHR0cENsaWVudCwgcHJpdmF0ZSBmb3JtQnVpbGRlcjogRm9ybUJ1aWxkZXIpIHtcbiAgICB0aGlzLnN0cmlwZUNhcmRGb3JtID0gdGhpcy5mb3JtQnVpbGRlci5ncm91cCh7XG4gICAgICBuYW1lOiBbJycsIFs8YW55PiBWYWxpZGF0b3JzLnJlcXVpcmVkXV0sXG4gICAgICBjYXJkTnVtYmVyOiBbJycsIFs8YW55PiBDcmVkaXRDYXJkVmFsaWRhdG9yLnZhbGlkYXRlQ0NOdW1iZXJdXSxcbiAgICAgIGV4cGlyYXRpb25EYXRlOiBbJycsIFs8YW55PiBDcmVkaXRDYXJkVmFsaWRhdG9yLnZhbGlkYXRlRXhwRGF0ZV1dLFxuICAgICAgY3ZjOiBbJycsIFs8YW55PiBWYWxpZGF0b3JzLnJlcXVpcmVkLCA8YW55PiBWYWxpZGF0b3JzLm1pbkxlbmd0aCgzKSwgPGFueT4gVmFsaWRhdG9ycy5tYXhMZW5ndGgoNCldXVxuICAgIH0pO1xuICB9XG5cdFxuICBAT3V0cHV0KClcbiAgYXBpUmVzcG9uc2U6IEV2ZW50RW1pdHRlcjxPYmplY3Q+ID0gbmV3IEV2ZW50RW1pdHRlcjxPYmplY3Q+KCk7XG5cbiAgQElucHV0KCdzdHJpcGVCdG5UZXh0JylcbiAgcHVibGljIHNldCBzZXRzdHJpcGVCdG5UZXh0KHN0cmlwZUJ0blRleHQ6IHN0cmluZykge1xuICAgIHRoaXMuc3RyaXBlQnRuVGV4dCA9IHN0cmlwZUJ0blRleHQ7XG4gICAgdGhpcy5CdG5UZXh0ID0gdGhpcy5zdHJpcGVCdG5UZXh0O1xuICB9XG5cdEBJbnB1dCgnY3VycmVuY3knKVxuICBwdWJsaWMgc2V0IHNldGN1cnJlbmN5KGN1cnJlbmN5OiBzdHJpbmcpIHtcbiAgICB0aGlzLmN1cnJlbmN5ID0gY3VycmVuY3k7IFxuICB9XG4gIEBJbnB1dCgnb3JkZXJJZCcpXG4gIHB1YmxpYyBzZXQgc2V0b3JkZXJJZChvcmRlcklkOiBzdHJpbmcpIHtcbiAgICB0aGlzLm9yZGVySWQgPSBvcmRlcklkO1xuICB9XG4gIEBJbnB1dCgnZW1haWwnKVxuICBwdWJsaWMgc2V0IHNldGVtYWlsKGVtYWlsOiBzdHJpbmcpIHtcbiAgICB0aGlzLmVtYWlsID0gZW1haWw7XG4gIH1cbiAgQElucHV0KCdzdHJpcGVCdG5Mb2FkaW5nJylcbiAgcHVibGljIHNldCBzZXRzdHJpcGVCdG5Mb2FkaW5nKHN0cmlwZUJ0bkxvYWRpbmc6IHN0cmluZykge1xuICAgIHRoaXMuc3RyaXBlQnRuTG9hZGluZyA9IHN0cmlwZUJ0bkxvYWRpbmc7XG4gIH1cblxuICBASW5wdXQoJ2FwaUtleScpXG4gIHB1YmxpYyBzZXQgc2V0YXBpS2V5KGFwaUtleTogc3RyaW5nKSB7XG4gICAgdGhpcy5hcGlLZXkgPSBhcGlLZXk7XG4gIH1cblxuICBASW5wdXQoJ2FwaVNlY3JldCcpXG4gIHB1YmxpYyBzZXQgc2V0YXBpU2VjcmV0KGFwaVNlY3JldDogc3RyaW5nKSB7XG4gICAgdGhpcy5hcGlTZWNyZXQgPSBhcGlTZWNyZXQ7XG4gIH1cbiAgQElucHV0KCd0b3RhbEFtb3VudCcpXG4gIHB1YmxpYyBzZXQgc2V0dG90YWxBbW91bnQodG90YWxBbW91bnQ6IG51bWJlcikge1xuICAgIHRoaXMudG90YWxBbW91bnQgPSB0b3RhbEFtb3VudDtcbiAgfVxuXG4gIG5nT25Jbml0KCkge1xuICB9XG5cbiAgLyogU3RyaXBlIFBheW1lbnQgKi9cbiAgZ2V0IGYoKSB7IHJldHVybiB0aGlzLnN0cmlwZUNhcmRGb3JtLmNvbnRyb2xzOyB9XG5cbiAgcGF5VXNpbmdTdHJpcGUoKSB7XG4gICAgY29uc3QgdG90YWwgPSBwYXJzZUZsb2F0KChNYXRoLnJvdW5kKHRoaXMudG90YWxBbW91bnQgKiAxMDApIC8gMTAwKS50b0ZpeGVkKDIpKTtcbiAgICBjb25zb2xlLmxvZygnVG90YWwgT3JkZXIgQW1vdW50aCBpcyAnICsgdG90YWwpO1xuICAgIGNvbnN0IGFtb3VudCA9IE1hdGgucm91bmQodG90YWwgKiAxMDApLnRvU3RyaW5nKCk7XG4gICAgdGhpcy5zdHJpcGUuc3VibWl0dGVkID0gdHJ1ZTtcblxuICAgIC8vIHN0b3AgaGVyZSBpZiBmb3JtIGlzIGludmFsaWRcbiAgICBpZiAodGhpcy5zdHJpcGVDYXJkRm9ybS5pbnZhbGlkKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5CdG5UZXh0ID0gdGhpcy5zdHJpcGVCdG5Mb2FkaW5nO1xuICAgIHRoaXMuc3RyaXBlLnN0cmlwQnRuRGlzYWJsZWQgPSB0cnVlO1xuXG4gICAgLyogR2VuZXJhdGluZyBjYXJkIHRva2VuICovXG4gICAgY29uc3QgdG9rZW5ib2R5ID0gbmV3IEh0dHBQYXJhbXMoKVxuICAgICAgLnNldCgnY2FyZFtudW1iZXJdJywgdGhpcy5zdHJpcGVDYXJkRm9ybS52YWx1ZS5jYXJkTnVtYmVyKVxuICAgICAgLnNldCgnY2FyZFtjdmNdJywgdGhpcy5zdHJpcGVDYXJkRm9ybS52YWx1ZS5jdmMpXG4gICAgICAuc2V0KCdjYXJkW2V4cF9tb250aF0nLCB0aGlzLmdldE1vbnRoKHRoaXMuc3RyaXBlQ2FyZEZvcm0udmFsdWUuZXhwaXJhdGlvbkRhdGUpKVxuICAgICAgLnNldCgnY2FyZFtleHBfeWVhcl0nLCB0aGlzLmdldFllYXIodGhpcy5zdHJpcGVDYXJkRm9ybS52YWx1ZS5leHBpcmF0aW9uRGF0ZSkpXG4gICAgICAuc2V0KCdjYXJkW25hbWVdJywgdGhpcy5zdHJpcGVDYXJkRm9ybS52YWx1ZS5uYW1lKVxuICAgICAgLnNldCgna2V5JywgdGhpcy5hcGlLZXkpO1xuICAgIGNvbnN0IGh0dHBPcHRpb25zID0ge1xuICAgICAgaGVhZGVyczogbmV3IEh0dHBIZWFkZXJzKHtcbiAgICAgICAgQXV0aG9yaXphdGlvbjogJ0JlYXJlciAnICsgdGhpcy5hcGlTZWNyZXQsXG4gICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkJ1xuICAgICAgfSlcbiAgICB9O1xuXG4gICAgdGhpc1xuICAgICAgLmh0dHBDbGllbnRcbiAgICAgIC5wb3N0KGBodHRwczovL2FwaS5zdHJpcGUuY29tL3YxL3Rva2Vuc2AsIHRva2VuYm9keSwgaHR0cE9wdGlvbnMpXG4gICAgICAuc3Vic2NyaWJlKFxuICAgICAgICAoZGF0YTogYW55KSA9PiB7XG4gICAgICAgICAgaWYgKGRhdGEpIHtcblxuICAgICAgICAgICAgY29uc3QgZGVzY3JpcHRpb24gPSAnT3JkZXIgaWQgJyArIHRoaXMub3JkZXJJZCArICcgYW5kIHVzZXIgJyArIHRoaXMuZW1haWwgKyAnJztcblxuICAgICAgICAgICAgY29uc3QgYm9keSA9IG5ldyBIdHRwUGFyYW1zKClcbiAgICAgICAgICAgICAgLnNldCgnYW1vdW50JywgYW1vdW50KVxuICAgICAgICAgICAgICAuc2V0KCdjdXJyZW5jeScsIHRoaXMuY3VycmVuY3kpXG4gICAgICAgICAgICAgIC5zZXQoJ3NvdXJjZScsIGRhdGEuaWQpXG4gICAgICAgICAgICAgIC5zZXQoJ2Rlc2NyaXB0aW9uJywgZGVzY3JpcHRpb24pOyBcblxuICAgICAgICAgICAgdGhpc1xuICAgICAgICAgICAgICAuaHR0cENsaWVudFxuICAgICAgICAgICAgICAucG9zdChgaHR0cHM6Ly9hcGkuc3RyaXBlLmNvbS92MS9jaGFyZ2VzYCwgYm9keSwgaHR0cE9wdGlvbnMpXG4gICAgICAgICAgICAgIC5zdWJzY3JpYmUoXG4gICAgICAgICAgICAgICAgKGRhdGFzOiBhbnkpID0+IHtcbiAgICAgICAgICAgICAgICAgIHRoaXMuYXBpUmVzcG9uc2UuZW1pdCh7ZGF0YTogZGF0YXMsIHRva2VuOiBkYXRhfSk7XG4gICAgICAgICAgICAgICAgICB0aGlzLnN0cmlwZS5zdHJpcEJ0bkRpc2FibGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgIHRoaXMuc3RyaXBlLnN0cmlwTWVzc2FnZSA9ICcnO1xuICAgICAgICAgICAgICAgICAgdGhpcy5CdG5UZXh0ID0gdGhpcy5zdHJpcGVCdG5UZXh0O1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgKGVycnM6IGFueSkgPT4ge1xuICAgICAgICAgICAgICAgICAgdGhpcy5hcGlSZXNwb25zZS5lbWl0KHticmVha3M6ICdjaGFyZ2VzJywgZXJyOiBlcnJzfSk7XG4gICAgICAgICAgICAgICAgICB0aGlzLnN0cmlwZS5zdHJpcEJ0bkRpc2FibGVkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICB0aGlzLkJ0blRleHQgPSB0aGlzLnN0cmlwZUJ0blRleHQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICApO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgKGVycjogYW55KSA9PiB7XG4gICAgICAgICAgdGhpcy5hcGlSZXNwb25zZS5lbWl0KHticmVha3M6ICd0b2tlbnMnLCBlcnI6IGVycn0pO1xuICAgICAgICAgIHRoaXMuc3RyaXBlLnN0cmlwQnRuRGlzYWJsZWQgPSBmYWxzZTtcbiAgICAgICAgICB0aGlzLkJ0blRleHQgPSB0aGlzLnN0cmlwZUJ0blRleHQ7XG4gICAgICAgIH1cbiAgICAgICk7XG4gIH1cblxuICBnZXRNb250aChkYXRhOiBhbnkpIHtcbiAgICByZXR1cm4gZGF0YS5zdWJzdHJpbmcoMCwgMik7XG4gIH1cbiAgZ2V0WWVhcihkYXRhOiBhbnkpIHtcbiAgICBjb25zdCB5ID0gZGF0YS5zcGxpdCgnLycpO1xuICAgIGlmICh5Lmxlbmd0aCA+IDEpIHtcbiAgICAgIHJldHVybiB5WzFdLnRyaW0oKTtcbiAgICB9XG4gIH0gXG59XG4iXX0=