{"version":3,"file":"ng-stripe.js","sources":["ng://ng-stripe/lib/ng-stripe.component.ts","ng://ng-stripe/lib/ng-stripe.module.ts"],"sourcesContent":["import { Component, OnInit, Input, Output, EventEmitter } from '@angular/core';\nimport { HttpClient, HttpHeaders, HttpParams } from '@angular/common/http';\nimport { FormGroup, FormBuilder, Validators } from '@angular/forms'; \nimport { CreditCardValidator } from 'angular-cc-library';\n\n@Component({\n  selector: 'lib-ng-stripe',\n  templateUrl: './ng-stripe.component.html',\n  styleUrls: ['./ng-stripe.component.css']\n})\nexport class NgStripeComponent implements OnInit {\n\n  public apiKey: string;\n  public apiSecret: string;\n  public totalAmount: number;\n  public stripeBtnText = 'Pay Now';\n  public stripeBtnLoading = 'Please Wait..';\n  public BtnText = 'Pay Now';\n  public orderId: any;\n  public email: any;\n  public currency: string;\n\n  /* Stripe */\n  public stripeCardForm: FormGroup;\n  stripe: any = {\n    stripeBtnText: 'Pay Now',\n    stripMessage: '',\n    stripBtnDisabled: false,\n    submitted: false,\n    stripData: {}\n  };\n  constructor(private httpClient: HttpClient, private formBuilder: FormBuilder) {\n    this.stripeCardForm = this.formBuilder.group({\n      name: ['', [<any> Validators.required]],\n      cardNumber: ['', [<any> CreditCardValidator.validateCCNumber]],\n      expirationDate: ['', [<any> CreditCardValidator.validateExpDate]],\n      cvc: ['', [<any> Validators.required, <any> Validators.minLength(3), <any> Validators.maxLength(4)]]\n    });\n  }\n\t\n  @Output()\n  apiResponse: EventEmitter<Object> = new EventEmitter<Object>();\n\n  @Input('stripeBtnText')\n  public set setstripeBtnText(stripeBtnText: string) {\n    this.stripeBtnText = stripeBtnText;\n    this.BtnText = this.stripeBtnText;\n  }\n\t@Input('currency')\n  public set setcurrency(currency: string) {\n    this.currency = currency; \n  }\n  @Input('orderId')\n  public set setorderId(orderId: string) {\n    this.orderId = orderId;\n  }\n  @Input('email')\n  public set setemail(email: string) {\n    this.email = email;\n  }\n  @Input('stripeBtnLoading')\n  public set setstripeBtnLoading(stripeBtnLoading: string) {\n    this.stripeBtnLoading = stripeBtnLoading;\n  }\n\n  @Input('apiKey')\n  public set setapiKey(apiKey: string) {\n    this.apiKey = apiKey;\n  }\n\n  @Input('apiSecret')\n  public set setapiSecret(apiSecret: string) {\n    this.apiSecret = apiSecret;\n  }\n  @Input('totalAmount')\n  public set settotalAmount(totalAmount: number) {\n    this.totalAmount = totalAmount;\n  }\n\n  ngOnInit() {\n  }\n\n  /* Stripe Payment */\n  get f() { return this.stripeCardForm.controls; }\n\n  payUsingStripe() {\n    const total = parseFloat((Math.round(this.totalAmount * 100) / 100).toFixed(2));\n    console.log('Total Order Amounth is ' + total);\n    const amount = Math.round(total * 100).toString();\n    this.stripe.submitted = true;\n\n    // stop here if form is invalid\n    if (this.stripeCardForm.invalid) {\n      return;\n    }\n\n    this.BtnText = this.stripeBtnLoading;\n    this.stripe.stripBtnDisabled = true;\n\n    /* Generating card token */\n    const tokenbody = new HttpParams()\n      .set('card[number]', this.stripeCardForm.value.cardNumber)\n      .set('card[cvc]', this.stripeCardForm.value.cvc)\n      .set('card[exp_month]', this.getMonth(this.stripeCardForm.value.expirationDate))\n      .set('card[exp_year]', this.getYear(this.stripeCardForm.value.expirationDate))\n      .set('card[name]', this.stripeCardForm.value.name)\n      .set('key', this.apiKey);\n    const httpOptions = {\n      headers: new HttpHeaders({\n        Authorization: 'Bearer ' + this.apiSecret,\n        'Content-Type': 'application/x-www-form-urlencoded'\n      })\n    };\n\n    this\n      .httpClient\n      .post(`https://api.stripe.com/v1/tokens`, tokenbody, httpOptions)\n      .subscribe(\n        (data: any) => {\n          if (data) {\n\n            const description = 'Order id ' + this.orderId + ' and user ' + this.email + '';\n\n            const body = new HttpParams()\n              .set('amount', amount)\n              .set('currency', this.currency)\n              .set('source', data.id)\n              .set('description', description); \n\n            this\n              .httpClient\n              .post(`https://api.stripe.com/v1/charges`, body, httpOptions)\n              .subscribe(\n                (datas: any) => {\n                  this.apiResponse.emit({data: datas, token: data});\n                  this.stripe.stripBtnDisabled = true;\n                  this.stripe.stripMessage = '';\n                  this.BtnText = this.stripeBtnText;\n                },\n                (errs: any) => {\n                  this.apiResponse.emit({breaks: 'charges', err: errs});\n                  this.stripe.stripBtnDisabled = false;\n                  this.BtnText = this.stripeBtnText;\n                }\n              );\n          }\n        },\n        (err: any) => {\n          this.apiResponse.emit({breaks: 'tokens', err: err});\n          this.stripe.stripBtnDisabled = false;\n          this.BtnText = this.stripeBtnText;\n        }\n      );\n  }\n\n  getMonth(data: any) {\n    return data.substring(0, 2);\n  }\n  getYear(data: any) {\n    const y = data.split('/');\n    if (y.length > 1) {\n      return y[1].trim();\n    }\n  } \n}\n","import { NgModule } from '@angular/core';\nimport { NgStripeComponent } from './ng-stripe.component';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { HttpClientModule } from '@angular/common/http';\nimport { BrowserModule } from '@angular/platform-browser'; \nimport { CreditCardDirectivesModule } from 'angular-cc-library';\n\n@NgModule({\n  declarations: [\n    NgStripeComponent\n  ],\n  imports: [\n    FormsModule,\n    HttpClientModule,\n    ReactiveFormsModule,\n    BrowserModule,\n\t\tCreditCardDirectivesModule\n  ],\n  providers: [],\n  exports: [NgStripeComponent]\n})\nexport class NgStripeModule { }"],"names":[],"mappings":"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"}